

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Environment setup &mdash; CLIP OS 5.0.0_beta3 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/colors.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Building" href="build.html" />
    <link rel="prev" title="Quick try guide" href="quick-try.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> CLIP OS
          

          
            
            <img src="../_static/clipos_logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                5.0 (Beta)
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">CLIP OS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../clipos/architecture.html">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../clipos/security.html">Security objectives</a></li>
<li class="toctree-l1"><a class="reference internal" href="../clipos/kernel.html">Kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../clipos/boot_integrity.html">Boot chain and integrity guarantees</a></li>
<li class="toctree-l1"><a class="reference internal" href="../clipos/update.html">System updates</a></li>
<li class="toctree-l1"><a class="reference internal" href="../clipos/roadmap.html">Roadmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../clipos/development.html">Development and debug</a></li>
</ul>
<p class="caption"><span class="caption-text">Development environment</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="quick-try.html">Quick try guide</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Environment setup</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#global-environment-configuration-requirements">Global environment configuration requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="#software-dependencies">Software dependencies</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#dependencies-installation-on-supported-linux-distributions">Dependencies installation on supported Linux-distributions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#how-to-fetch-the-entire-source-tree">How to fetch the entire source tree?</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="build.html">Building</a></li>
<li class="toctree-l1"><a class="reference internal" href="test.html">Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="build-steps.html">Build steps</a></li>
<li class="toctree-l1"><a class="reference internal" href="source-tree.html">Source tree organization</a></li>
</ul>
<p class="caption"><span class="caption-text">Contributing</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="contribute.html">How to contribute</a></li>
<li class="toctree-l1"><a class="reference internal" href="derive.html">How to derive this project</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">CLIP OS</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Environment setup</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/toolkit/setup.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="environment-setup">
<span id="setup"></span><h1>Environment setup<a class="headerlink" href="#environment-setup" title="Permalink to this headline">¶</a></h1>
<p>This document will walk you through the steps to setup the environment required
to use the tools in the CLIP OS project.</p>
<div class="section" id="global-environment-configuration-requirements">
<h2>Global environment configuration requirements<a class="headerlink" href="#global-environment-configuration-requirements" title="Permalink to this headline">¶</a></h2>
<p>Here is a requirements check-list about your global environment:</p>
<ol class="arabic">
<li><p class="first">You must run a <strong>64-bit x86 system</strong> (a.k.a. <code class="docutils literal notranslate"><span class="pre">AMD64</span></code>, <code class="docutils literal notranslate"><span class="pre">Intel</span> <span class="pre">64</span></code> or
<code class="docutils literal notranslate"><span class="pre">x86_64</span></code>) architecture.</p>
<div class="tip admonition">
<p class="first admonition-title">About other system architectures</p>
<p class="last">Cross-compiling to other system architectures is not supported yet. No
other host system architecture is supported yet.</p>
</div>
</li>
<li><p class="first">You must run <strong>Linux</strong>. No other operating system is supported. Any
relatively recent and stable kernel provided by a major Linux distribution
should be compatible with the CLIP OS toolkit.</p>
<div class="note admonition">
<p class="first admonition-title">Supported Linux distributions</p>
<p>The project is regularly tested and known to work with the following
distributions:</p>
<blockquote>
<div><ul class="simple">
<li>Arch Linux</li>
<li>Debian 10 (stable)</li>
</ul>
</div></blockquote>
<p>Although not regularly tested, the following distributions are supported
(i.e. we will investigate and fix reported bugs) and the project should
work on those:</p>
<blockquote class="last">
<div><ul class="simple">
<li>Debian testing and unstable</li>
<li>Fedora 31 and later</li>
<li>Ubuntu 18.04 and later</li>
<li>CentOS 8 and later</li>
</ul>
</div></blockquote>
</div>
<div class="tip admonition">
<p class="first admonition-title">About other Linux distributions</p>
<p class="last">The project will likely work on other distributions but there is
currently no plan to extend our support. If your distribution kernel is
at least version 4.19 and supports all the features used by the CLIP OS
toolkit (such as namespaces, capabilities, cgroups, OverlayFS, tmpfs,
etc.), it is expected to work without issue.</p>
</div>
</li>
<li><p class="first">Both your hardware and your kernel must support <strong>KVM</strong> (through Intel VT-x
or AMD-V technologies) to run CLIP OS virtual machine images in the virtual
testbed. Building without KVM support is supported but testing requires KVM
support and access to an instance of <strong>libvirt</strong>.</p>
</li>
<li><p class="first"><strong>Podman</strong> is required to spawn SDK containers to build CLIP OS. Rootless
podman is supported and rootfull podman support requires <strong>Super-user
privileges</strong> acquired through <strong>sudo</strong>. Running containers with <strong>Docker</strong>
is also supported but not actively tested.</p>
</li>
<li><p class="first">Make sure to have allocated a consequent size of <strong>swap space</strong> on your
system as it might be required when working on large ephemeral SDK
environments. Having a lot of RAM (16GB+) will also help.</p>
<div class="tip admonition">
<p class="first admonition-title">Why this requirement?</p>
<p class="last">SDK ephemeral containers make use of “in-memory” <em>tmpfs</em> OverlayFS
layers. As a consequence, there are scenarios where memory usage may be
large (typically when bootstrapping the CLIP OS SDK image) and may not
fit the entire memory of the system.</p>
</div>
</li>
<li><p class="first">Make sure to have <strong>enough free storage space</strong> before getting the source
tree as it can take up to several gigabytes of storage, and even more when
you will begin building CLIP OS images. 50GB should be a minimum.</p>
</li>
<li><p class="first">Make sure to work in a <strong>filesystem without any restricted features</strong> such
as <cite>noexec</cite> or <cite>nodev</cite> as it will cause undefined issues throughout the
building process of some parts of the CLIP OS images.</p>
</li>
</ol>
</div>
<div class="section" id="software-dependencies">
<h2>Software dependencies<a class="headerlink" href="#software-dependencies" title="Permalink to this headline">¶</a></h2>
<div class="tip admonition">
<p class="first admonition-title">TL;DR</p>
<p class="last">If your are using a distribution supported by the project, you may skip this
part of the documentation and jump directly to the section
<a class="reference internal" href="#dependencies-installation-on-supported-linux-distributions"><span class="std std-ref">Dependencies installation on supported Linux-distributions</span></a>.
Otherwise (or if you encounter issues with the above method), please
continue reading this section.</p>
</div>
<p>To get a functional environment, you will need these software dependencies in
your userland:</p>
<ul>
<li><p class="first"><strong>Git</strong> as all the source code is versioned through Git repositories.</p>
</li>
<li><p class="first"><strong>Git LFS</strong> (Git Large File Storage extension) is required to fetch Git
repositories with a lot of large binary files.</p>
<div class="note admonition">
<p class="first admonition-title">Alternative way to install Git LFS</p>
<p class="last">If <code class="docutils literal notranslate"><span class="pre">git-lfs</span></code> is not provided through a package of your Linux
distribution, you can follow instructions from the <a class="reference external" href="https://github.com/git-lfs/git-lfs/wiki/Installation">Git LFS project pages</a> to install it.</p>
</div>
</li>
<li><p class="first"><strong>repo</strong> (tool from the Android Open Source Project) is required to fetch
the source tree.</p>
<div class="note admonition">
<p class="first admonition-title">Alternative way to install repo</p>
<p class="last"><code class="docutils literal notranslate"><span class="pre">repo</span></code> might be packaged by your Linux distribution. Otherwise you may
have to get it and install it from source. To do so, follow the related
instructions on <a class="reference external" href="https://source.android.com/setup/build/downloading#installing-repo">the Android Open Source project page regarding the setup
of the environment for AOSP</a>.</p>
</div>
</li>
<li><p class="first"><strong>Bash 4.1 (or later)</strong> is required for some toolkit helper scripts.</p>
</li>
<li><p class="first">The <strong>Go</strong> compiler (version <strong>1.12 or above</strong>) is required to build the
<code class="docutils literal notranslate"><span class="pre">cosmk</span></code> tool.</p>
<div class="note admonition">
<p class="first admonition-title">Alternative way to install Go</p>
<p class="last">If your ditribution does not have a recent enough version of Go, you may
download a pre-built official version from <a class="reference external" href="https://golang.org/">golang.org</a>.</p>
</div>
</li>
<li><p class="first"><strong>Podman</strong> is required to launch SDK containers. SDK containers may be run
rootless using podman or rootfull using podman. Running SDK containers
rootfull will also require <strong>sudo</strong> for automatic privilege escalation (the
current unprivileged user must be a <code class="docutils literal notranslate"><span class="pre">sudoer</span></code> to be able to gain those
privileges). Running container with <strong>Docker</strong> is also supported and requires
<strong>sudo</strong>.</p>
</li>
<li><p class="first"><strong>libvirt with QEMU and KVM support</strong> are required as the platform to run the
CLIP OS virtual machines with QEMU with virtualized networks. The <strong>Python 3
module for libvirt</strong> and a TPM emulator are also required.</p>
<div class="tip admonition">
<p class="first admonition-title">Avoid running QEMU as root if not necessary</p>
<p>On some Linux distributions (e.g., Arch Linux), libvirt is provided with a
default configuration which runs QEMU as root. If you intend to use
libvirt only for the purpose of running CLIP OS QEMU images, you may want
to run the QEMU processes launched by libvirt as your current user.</p>
<p>To do so, edit the file <code class="docutils literal notranslate"><span class="pre">/etc/libvirt/qemu.conf</span></code> and change the values
for the <code class="docutils literal notranslate"><span class="pre">user</span></code> and <code class="docutils literal notranslate"><span class="pre">group</span></code> as follows:</p>
<div class="last highlight-guess notranslate"><div class="highlight"><pre><span></span>user = &quot;myusername&quot;  # replace with your current username
group = &quot;kvm&quot;
</pre></div>
</div>
</div>
</li>
<li><p class="first"><strong>Optionnal (but recommended):</strong> <strong>liguestfs tools</strong> to build the disk image
for the QEMU virtual machine. If unavailable, <strong>Podman</strong> or <strong>Docker</strong> will
be used to run libguestfs inside a container.</p>
</li>
<li><p class="first"><strong>Optionnal:</strong> <strong>Sphinx</strong> and the <strong>Read the Docs Theme</strong> to build the
documentation. If unavailable, <strong>Podman</strong> or <strong>Docker</strong> will be used to run
Sphinx inside a container.</p>
</li>
</ul>
<div class="section" id="dependencies-installation-on-supported-linux-distributions">
<span id="id1"></span><h3>Dependencies installation on supported Linux-distributions<a class="headerlink" href="#dependencies-installation-on-supported-linux-distributions" title="Permalink to this headline">¶</a></h3>
<p>On Ubuntu or Debian (with <code class="docutils literal notranslate"><span class="pre">contrib</span></code> sources enabled for Debian):</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> sudo apt install <span class="se">\</span>
       gnupg2 repo git git-lfs openssh-client golang jq zstd <span class="se">\</span>
       qemu qemu-utils libvirt-dev libvirt-daemon python3-libvirt <span class="se">\</span>
       libguestfs-tools virt-manager gir1.2-spiceclientglib-2.0 <span class="se">\</span>
       gir1.2-spiceclientgtk-3.0
</pre></div>
</div>
<div class="note admonition">
<p class="first admonition-title">Installing Podman or Docker</p>
<p>On Debian and Ubuntu systems, you will have to choose between Podman
(recommended) and Docker and install them on your system using the following
guides:</p>
<ul class="last simple">
<li><a class="reference external" href="https://github.com/containers/libpod/blob/master/install.md">Podman for Ubuntu and Debian</a></li>
<li><a class="reference external" href="https://docs.docker.com/install/linux/docker-ce/ubuntu/">Docker for Ubuntu</a></li>
<li><a class="reference external" href="https://docs.docker.com/install/linux/docker-ce/debian/">Docker for Debian</a></li>
</ul>
</div>
<div class="note admonition">
<p class="first admonition-title">Installing libtpms and swtpm on Ubuntu or Debian</p>
<p class="last">As there is currently no official package for libtpms and swtpm on
Ubuntu and Debian, you will have to follow the instructions from the
<code class="docutils literal notranslate"><span class="pre">INSTALL</span></code> file on their respective GitHub repositories:
<a class="reference external" href="https://github.com/stefanberger/libtpms">libtpms</a> and
<a class="reference external" href="https://github.com/stefanberger/swtpm">swtpm</a>.</p>
</div>
<p>On Fedora and CentOS:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> sudo dnf install <span class="se">\</span>
       gnupg git git-lfs openssh-clients podman golang jq zstd <span class="se">\</span>
       qemu libvirt-devel libvirt-daemon python3-libvirt libvirt-client <span class="se">\</span>
       libguestfs-tools virt-manager

<span class="gp">#</span> Vagrant setup <span class="k">for</span> testbed environment
<span class="gp">$</span> sudo dnf install vagrant --setopt<span class="o">=</span><span class="nv">install_weak_deps</span><span class="o">=</span>False
<span class="gp">$</span> sudo dnf install @development-tools ruby-devel zlib-devel
<span class="gp">$</span> vagrant plugin install vagrant-libvirt

<span class="gp">#</span> Virtual TPM support <span class="o">(</span>Fedora only<span class="o">)</span>
<span class="gp">$</span> sudo dnf install swtpm swtpm-tools
</pre></div>
</div>
<div class="note admonition">
<p class="first admonition-title">Installing libtpms and swtpm on CentOS</p>
<p class="last">As there is currently no official package for libtpms and swtpm on CentOS,
you will have to follow the instructions from the <code class="docutils literal notranslate"><span class="pre">INSTALL</span></code> file on their
respective GitHub repositories:
<a class="reference external" href="https://github.com/stefanberger/libtpms">libtpms</a> and
<a class="reference external" href="https://github.com/stefanberger/swtpm">swtpm</a>.</p>
</div>
<p>On Arch Linux:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> sudo pacman -Syu <span class="se">\</span>
      gnupg repo git git-lfs openssh podman go jq zstd <span class="se">\</span>
      qemu libvirt bridge-utils dnsmasq ebtables libvirt-python <span class="se">\</span>
      virt-manager

<span class="gp">#</span> Vagrant setup <span class="k">for</span> testbed environment
<span class="gp">$</span> sudo pacman -Syu vagrant
<span class="gp">$</span> vagrant plugin install vagrant-libvirt
</pre></div>
</div>
<div class="note admonition">
<p class="first admonition-title">Installing libguestfs, libtpms and swtpm on Arch Linux</p>
<p class="last">As there is currently no official package for those packages on Arch Linux,
you will have to install them using AUR packages:
<a class="reference external" href="https://aur.archlinux.org/packages/libguestfs">libguestfs</a>,
<a class="reference external" href="https://aur.archlinux.org/packages/libtpms">libtpms</a>,
<a class="reference external" href="https://aur.archlinux.org/packages/tpm-tools">tpm-tools</a> and
<a class="reference external" href="https://aur.archlinux.org/packages/swtpm">swtpm</a>.</p>
</div>
</div>
</div>
<div class="section" id="how-to-fetch-the-entire-source-tree">
<h2>How to fetch the entire source tree?<a class="headerlink" href="#how-to-fetch-the-entire-source-tree" title="Permalink to this headline">¶</a></h2>
<p>The project source tree is split among several distinct repositories that are
managed together using <code class="docutils literal notranslate"><span class="pre">repo</span></code>.</p>
<div class="important admonition">
<p class="first admonition-title">Make sure the Git LFS filters are enabled</p>
<p>To enable the Git LFS filters for your current user (changes will be made in
<code class="docutils literal notranslate"><span class="pre">~/.gitconfig</span></code>), please run:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> git-lfs install --skip-repo
</pre></div>
</div>
<p class="last">This step should be done before synchronizing the whole CLIP OS source tree
to automatically download the files stored with Git LFS.</p>
</div>
<div class="error admonition">
<p class="first admonition-title">Watch out for unusual <em>umask</em> values!</p>
<p>Due to the fact that we bind-mount the source tree within SDK containers,
<strong>please ensure to fetch and synchronize the entire source tree with a umask
value keeping permissions to read files and traverse directories</strong>
(recommended <em>umask</em> value <code class="docutils literal notranslate"><span class="pre">0022</span></code>).</p>
<p class="last">Failure to do so may lead to undefined issues when using the CLIP OS toolkit
as all the file modes of this source tree are left unchanged when they are
exposed within SDK containers. As a consequence, some unprivileged programs
running in these containers might encounter a “Permission denied” error when
trying to read files whose mode deny access for “others”.</p>
</div>
<p>Then to get the entire source tree:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> mkdir clipos
<span class="gp">$</span> <span class="nb">cd</span> clipos
<span class="gp">$</span> <span class="nb">umask</span> <span class="m">0022</span>
<span class="gp">$</span> git lfs install --skip-repo
<span class="gp">$</span> repo init -u https://github.com/CLIPOS/manifest
<span class="gp">$</span> repo sync
</pre></div>
</div>
<p>This may take some time (several minutes at least, but this depends on your
network bandwidth) as several Git repositories need to be cloned, including
large Git repositories holding lots of contents and history, such as the Linux
kernel (<code class="docutils literal notranslate"><span class="pre">src/external/linux/</span></code>) or the Gentoo Portage tree
(<code class="docutils literal notranslate"><span class="pre">src/portage/gentoo/</span></code>).</p>
<div class="tip admonition">
<p class="first admonition-title">Quicker synchronization</p>
<p>You can instruct <code class="docutils literal notranslate"><span class="pre">repo</span></code> to synchronize all the sub-repositories
concurrently by using multiple Git processes:</p>
<div class="last highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> repo sync -j4
</pre></div>
</div>
</div>
<p>At this point, you should have successfully set up your environment and
fetched the whole source tree of the CLIP OS project.</p>
<div class="note admonition">
<p class="first admonition-title">Quick fix for Git LFS issues</p>
<p>If for any reason the Git LFS filters were not installed during <code class="docutils literal notranslate"><span class="pre">repo</span>
<span class="pre">sync</span></code>, you can still download the missing contents of the files backed by
Git LFS (and therefore fix your current source tree checkout) by running
this command:</p>
<div class="last highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> repo forall -c <span class="s1">&#39;git lfs install &amp;&amp; git lfs pull&#39;</span>
</pre></div>
</div>
</div>
<p>Congratulations, you are now ready to start <a class="reference internal" href="build.html#build"><span class="std std-ref">building CLIP OS</span></a>.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="build.html" class="btn btn-neutral float-right" title="Building" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="quick-try.html" class="btn btn-neutral float-left" title="Quick try guide" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, ANSSI. CLIP OS is a trademark of the French Republic. For more details, see the &#34;How to derive this project&#34; section. The contents of this documentation is available under the Open License version 2.0 as published by Etalab (French task force for Open Data)

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>