

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Building &mdash; CLIP OS 5.0.0_alpha1 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/colors.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Build steps" href="build-steps.html" />
    <link rel="prev" title="Environment setup" href="setup.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> CLIP OS
          

          
            
            <img src="../_static/clipos_logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                5.0 (Alpha)
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">CLIP OS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../clipos/architecture.html">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../clipos/security.html">Security objectives</a></li>
<li class="toctree-l1"><a class="reference internal" href="../clipos/kernel.html">Kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../clipos/boot_integrity.html">Boot chain and integrity guarantees</a></li>
<li class="toctree-l1"><a class="reference internal" href="../clipos/roadmap.html">Roadmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../clipos/development.html">Development and debug</a></li>
</ul>
<p class="caption"><span class="caption-text">Development environment</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="setup.html">Environment setup</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Building</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#setup-and-activate-the-toolkit-environment">Setup and activate the toolkit environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="#building-the-full-project">Building the full project</a></li>
<li class="toctree-l2"><a class="reference internal" href="#building-a-qemu-image-and-running-using-qemu-kvm">Building a QEMU image and running using QEMU/KVM</a></li>
<li class="toctree-l2"><a class="reference internal" href="#instrumented-build-for-testing">Instrumented build for testing</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="build-steps.html">Build steps</a></li>
<li class="toctree-l1"><a class="reference internal" href="source-tree.html">Source tree organization</a></li>
</ul>
<p class="caption"><span class="caption-text">Contributing</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="contribute.html">How to contribute</a></li>
<li class="toctree-l1"><a class="reference internal" href="derive.html">How to derive this project</a></li>
</ul>
<p class="caption"><span class="caption-text">Toolkit API references</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="cosmk-api.html"><code class="docutils literal notranslate"><span class="pre">cosmk</span></code> Python API</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">CLIP OS</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Building</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/toolkit/build.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="building">
<span id="build"></span><h1>Building<a class="headerlink" href="#building" title="Permalink to this headline">¶</a></h1>
<div class="important admonition">
<p class="first admonition-title">Before going further, ensure to get a functional build
             environment setup</p>
<p class="last">You must complete the <a class="reference internal" href="setup.html#setup"><span class="std std-ref">toolkit environment setup</span></a> before
executing any command from this page.</p>
</div>
<div class="section" id="setup-and-activate-the-toolkit-environment">
<h2>Setup and activate the toolkit environment<a class="headerlink" href="#setup-and-activate-the-toolkit-environment" title="Permalink to this headline">¶</a></h2>
<p>Setup and activate the CLIP OS toolkit environment in which you will be able
to use all the CLIP OS tools required to build and conveniently manage the
source tree (such as <code class="docutils literal notranslate"><span class="pre">just</span></code> to handle the <code class="docutils literal notranslate"><span class="pre">justfile</span></code>’s and <code class="docutils literal notranslate"><span class="pre">cosmk</span></code>):</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> toolkit/setup.sh    <span class="c1"># This is to be run at least once on your machine.</span>
<span class="gp">$</span> <span class="nb">source</span> toolkit/activate
<span class="gp">(toolkit) $</span>           <span class="c1"># Your shell prompt is automatically prefixed.</span>
</pre></div>
</div>
<div class="note admonition">
<p class="first admonition-title">About the CLIP OS toolkit virtualenv setup</p>
<p>The purpose of the script <code class="docutils literal notranslate"><span class="pre">toolkit/setup.sh</span></code> is to compile and store the
CLIP OS toolkit environment under the form of a Python virtualenv in
<code class="docutils literal notranslate"><span class="pre">run/venv</span></code> directory. You might be invited to run it again if the
specification of the toolkit environment has changed over time.</p>
<p class="last">This setup script can take some time (up to a couple of minutes) to complete
on the first launch as it will automatically trigger the compilation of some
CPython packages required by the CLIP OS toolkit. Thanks for your patience.</p>
</div>
</div>
<div class="section" id="building-the-full-project">
<h2>Building the full project<a class="headerlink" href="#building-the-full-project" title="Permalink to this headline">¶</a></h2>
<p>You will then be able to use the <code class="docutils literal notranslate"><span class="pre">justfile</span></code>’s to run commands to build CLIP
OS. Building the CLIP OS project requires multiple successive steps that are
described in <a class="reference external" href="https://github.com/casey/just">Justfiles</a>. All commands are run
from the project root directory.</p>
<p>To list the available <cite>just</cite> recipes:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">(toolkit) $</span> just --list
</pre></div>
</div>
<p>To run all steps required to build CLIP OS:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">(toolkit) $</span> sujust all
</pre></div>
</div>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">As some tasks need root privileges to function properly you must pay
attention to which <code class="docutils literal notranslate"><span class="pre">just</span></code> commands needs <code class="docutils literal notranslate"><span class="pre">root</span></code> privileges as there are
other <code class="docutils literal notranslate"><span class="pre">just</span></code> commands (such as helpers for source repository and branch
manipulation) which <strong>do not</strong> require <code class="docutils literal notranslate"><span class="pre">root</span></code> privileges.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>On most distributions, the default configuration will reset the
<code class="docutils literal notranslate"><span class="pre">PATH</span></code> environment variable set by the CLIP OS toolkit environment to a
fixed default value when calling <code class="docutils literal notranslate"><span class="pre">sudo</span></code>.</p>
<p class="last">To workaround this issue without modifying your <code class="docutils literal notranslate"><span class="pre">sudoers</span></code> configuration,
the CLIP OS toolkit environment sets an alias for the sudo command to keep
your current <code class="docutils literal notranslate"><span class="pre">PATH</span></code>.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>On some distributions (e.g., Debian), the default user <code class="docutils literal notranslate"><span class="pre">$PATH</span></code> variable
does not include the <code class="docutils literal notranslate"><span class="pre">/sbin</span></code> and <code class="docutils literal notranslate"><span class="pre">/usr/sbin</span></code> folders. Please add those
to your user <code class="docutils literal notranslate"><span class="pre">$PATH</span></code>. For example:</p>
<div class="last highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$PATH</span><span class="s2">:/sbin:/usr/sbin&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="building-a-qemu-image-and-running-using-qemu-kvm">
<h2>Building a QEMU image and running using QEMU/KVM<a class="headerlink" href="#building-a-qemu-image-and-running-using-qemu-kvm" title="Permalink to this headline">¶</a></h2>
<p>To build a QCOW2 QEMU disk image and to setup a EFI &amp; QEMU/KVM enabled virtual
machine with <code class="docutils literal notranslate"><span class="pre">libvirt</span></code>, use:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">(toolkit) $</span> sujust qemu
</pre></div>
</div>
<div class="important admonition">
<p class="first admonition-title">Local login disabled by default</p>
<p class="last">The default build configuration will create production images with root
access disabled. See the next paragraph for instructions to create an
instrumented build.</p>
</div>
<div class="important admonition">
<p class="first admonition-title">TPM support</p>
<p class="last">To test the TPM support, you need to install
<a class="reference external" href="https://github.com/stefanberger/libtpms">libtpms</a> and
<a class="reference external" href="https://github.com/stefanberger/swtpm">swtpm</a> using either instructions
from the <code class="docutils literal notranslate"><span class="pre">INSTALL</span></code> file on their respective GitHub repositories or the AUR
packages for Arch Linux users.</p>
</div>
</div>
<div class="section" id="instrumented-build-for-testing">
<h2>Instrumented build for testing<a class="headerlink" href="#instrumented-build-for-testing" title="Permalink to this headline">¶</a></h2>
<p>In order to test the QEMU images, you have to select the instrumentation level
you want by copying the <code class="docutils literal notranslate"><span class="pre">toolkit/instrumentation.toml.example</span></code> example in the
source tree root folder:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">(toolkit) $</span> cp toolkit/instrumentation.toml.example instrumentation.toml
</pre></div>
</div>
<p>The default instrumented configuration will enable you to log in as root
without password. You will have to rebuild the project and the QEMU image to
apply the change:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">(toolkit) $</span> sujust all
<span class="gp">(toolkit) $</span> sujust qemu
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="build-steps.html" class="btn btn-neutral float-right" title="Build steps" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="setup.html" class="btn btn-neutral" title="Environment setup" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, ANSSI. CLIP OS is a trademark of the French Republic. For more details, see the &#34;How to derive this project&#34; section. The contents of this documentation is available under the Open License version 2.0 as published by Etalab (French task force for Open Data)

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    

  

  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>